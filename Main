import requests

# بيانات بوتك من الصورة التي أرسلتها
token = "8077653985:AAGhWIjLPaSf3Y3J6gNJw-hIQOW4gKPvvIM"
chat_id = "@ARYtrade_bot"

# Alpha Vantage API — يمكنك استخدام "demo" أو مفتاحك الخاص لاحقًا
api_key = "demo"
symbol = "XAUUSD"
interval = "5min"

url = f"https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol={symbol}&interval={interval}&apikey={api_key}"

def get_signal():
    try:
        r = requests.get(url)
        data = r.json()

        candles = list(data["Time Series (5min)"].items())
        if len(candles) < 2:
            return None

        last_close = float(candles[0][1]["4. close"])
        prev_close = float(candles[1][1]["4. close"])

        if last_close > prev_close:
            return f"📈 BUY Signal on {symbol} at {last_close}"
        elif last_close < prev_close:
            return f"📉 SELL Signal on {symbol} at {last_close}"
        else:
            return "⚠️ No clear signal."
    except Exception as e:
        return f"❌ Error: {str(e)}"

def send_telegram(msg):
    telegram_url = f"https://api.telegram.org/bot{token}/sendMessage"
    payload = {"chat_id": chat_id, "text": msg}
    requests.post(telegram_url, data=payload)

if __name__ == "__main__":
    signal = get_signal()
    if signal:
        send_telegram(signal)
